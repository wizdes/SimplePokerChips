<!DOCTYPE html>
<html>
<head>
    <title>Poker</title>
    <style type="text/css">
        .container {
            background-color: #99CCFF;
            border: thick solid #808080;
            padding: 20px;
            margin: 20px;
        }
    </style>
</head>
<body>
    <h1> Poker Chips with JAYKER</h1>

<p>
    <div id="yourname">
    </div>
    <div id="uchip">
        Your Chips : $ 100
    </div>

    <br/>

    <button id="bet5" type="button" class="btn btn-default btn-lg">5</button>
    <!--<button id="bet10" type="button" class="btn btn-default btn-lg">10</button>
    <button id="bet20" type="button" class="btn btn-default btn-lg">20</button>
    <button id="bet50" type="button" class="btn btn-default btn-lg">50</button>-->

    <div id="users">

    </div>
    <div id="otherchips">
    </div>
    <br/>
    <br/>
    <div id="pot"></div>
    <br/>
    <button id="betpot" type="button" class="btn btn-default btn-lg">Take Pot</button>
    <button id="sync" type="button" class="btn btn-default btn-lg">Sync</button>
</p>

    <input type="hidden" id="message" />
    <input type="hidden" id="sendmessage" value="Send" />
    <input type="hidden" id="displayname" />
    <ul id="discussion"></ul>

<!--Script references. -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!--Reference the jQuery library. -->
<script src="Scripts/jquery-1.6.4.min.js"></script>
<!--Reference the SignalR library. -->
<script src="/Scripts/jquery.signalR-2.0.0.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="/signalr/hubs"></script>
<!--Add script to update the page and send messages.-->
<script type="text/javascript">
    var money = 100;
    var name = "foo";
    var pot = 0;
    var started = false;
    var strings = [];
    $(function() {
        // Declare a proxy to reference the hub.
        var chat = $.connection.chatHub;
        // Create a function that the hub can call to broadcast messages.
        chat.client.broadcastMessage = function(name, message) {
            // Html encode display name and message.
            //var encodedName = $('<div />').text(name).html();
            //var encodedMsg = $('<div />').text(message).html();
            //// Add the message to the page.
            //$('#discussion').append('<li><strong>' + encodedName
            //    + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');

            var x = false;
            var syncing = false;
            var potting = false;
            
            if (message.indexOf("sync") != -1) {
                message = message.replace("sync", "");
                syncing = true;
            }
            if (message.indexOf("pot") != -1) {
                message = message.replace("pot", "");
                potting = true;
            }


            for (var i = 0; i < strings.length; i++) {
                if (strings[i].indexOf(name) != -1) {
                    strings.splice(i, 1);
                    x = true;
                    break;
                }
            };

            //alert("first" + pot);

            if (potting == true) {
                pot = 0;
                $('#pot').text("Pot: $" + pot);
            } else {
                if (x == true && syncing == false) {
                    //alert("second" + pot);
                    pot = pot + 5;
                    $('#pot').text("Pot: $" + pot);
                } else {
                    started = true;
                }
            }
            //alert("Last" + pot);


            strings.push(name + "'s chips: " + message + "\n");

            var valStr = "";

            for (var i = 0; i < strings.length; i++) {
                valStr += strings[i] + "\n";
            };

            $('#otherchips').text(valStr);


        };
        // Get the user name and store it to prepend to messages.
        $('#displayname').val(prompt('Enter your name:', ''));

        name = $('#displayname').val();

        $('#yourname').text(name);

        // Set initial focus to message input box.
        //$('#message').focus();
        // Start the connection.
        $.connection.hub.start().done(function () {
            chat.server.send($('#displayname').val(), money);
            $('#sendmessage').click(function() {
                // Call the Send method on the hub.
                chat.server.send($('#displayname').val(), $('#message').val());
                // Clear text box and reset focus for next comment.
                //$('#message').val('').focus();
            });

            $('#bet5').click(function () {
                // Call the Send method on the hub.
                chat.server.send($('#displayname').val(), money - 5);
    
                money = money - 5;
                $('#uchip').text("Your chips: " + money);
                // Clear text box and reset focus for next comment.
                //$('#message').val('').focus();
            });

            $('#betpot').click(function () {
                // Call the Send method on the hub.
                chat.server.send($('#displayname').val(), (money + pot)+"pot");

                money = money + pot;
                $('#uchip').text("Your chips: " + money);
                // Clear text box and reset focus for next comment.
                //$('#message').val('').focus();
            });
            $('#sync').click(function () {
                // Call the Send method on the hub.
                chat.server.send($('#displayname').val(), money+"sync");

                $('#uchip').text("Your chips: " + money);
                // Clear text box and reset focus for next comment.
                //$('#message').val('').focus();
            });

        });
    });
</script>
</body>
</html>